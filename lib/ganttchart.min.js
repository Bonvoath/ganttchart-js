"use strict";!function(x){var T=864e5,D=function(r,e,s){for(var t=function(e){var t=s.getTaskAt(e),n={act:{}};if(!t.grouped){var a=null;if(t.startDate){a={date:d.strToDate(t.startDate),hours:0};for(var l=0;l<30&&(a.hours=r.getActHours(a.date,t.assignee),!(0<a.hours));l+=1)a.date.setDate(a.date.getDate()+1)}u[t.assignee]&&(a&&+a.date>+u[t.assignee].date||(a=u[t.assignee])),a&&(n.simStartDate=d.parseDate(a.date),n.simStartHours=a.hours);var i=t.currEst||t.origEst;if(i&&a){var o=0;for(i=+i;0<i;)i>=a.hours?0<a.hours?(o+=a.hours,i-=a.hours,a.hours=0):o+=r.dayInHours:(o+=i,a.hours-=i,i=0),0<i&&(a.date.setDate(a.date.getDate()+1),a.hours+=r.getActHours(a.date,t.assignee));u[t.assignee]=a,n.simFinishDate=d.parseDate(a.date),n.simEndHours=a.hours,n.simEst=o}}return n},d=x.util,n=s.getTaskCount(),u={},a=function(){a={};for(var e=0;e<n;e+=1)a[e]=t(e);return a}(),l=0;l<n;l+=1){var i=s.getTaskAt(l),o=a[l];if(i.grouped){for(var c=[],f=l+1;f<n;f+=1){var h=s.getTaskAt(f);if(h.indent<=i.indent)break;f+1<n&&s.getTaskAt(f+1).indent>h.indent||c.push({task:h,taskEx:a[f]})}for(var p in e)"assignee"==p?o.assignees=e[p](c):o[p]=e[p](c);0!=+o.remain&&(o.actFinishDate="");for(var g={},m=0;m<c.length;m+=1){var v=c[m].task.act;for(var b in v)g[b]?g[b]+=+v[b]:g[b]=+v[b]}for(var b in g)o.act[b]=d.formatNumber(g[b],2)}}return a},E=function(){var e=x.util,t=x.i18n;return e.extend(t.en.messages,{MAN_HOURS:"Man Hours",ORIGINAL:"Original",ACTUAL:"Actual",WBS:"WBS",TASK_ID:"Task ID",TASK_NAME:"Task Name",ASSIGNEE:"Assignee",ORIG_EST:"Orig Est",CURR_EST:"Curr Est",ELAPSED:"Elapsed",REMAIN:"Remain",START_DATE:"Start",FINISH_DATE:"Finish",LINK:"Link",LINK_TYPE:"Type",LINKED_TASK:"Task",INSERT_ROW:"Insert Row",DELETE_ROW:"Delete Row",MOVE_UP:"Move Up",MOVE_DOWN:"Move Down",INDENT_UP:"Indent Up <",INDENT_DOWN:"Indent Down >"}),e.extend(t.ja.messages,{MAN_HOURS:"\u5de5\u6570(h)",ORIGINAL:"\u4e88\u5b9a",ACTUAL:"\u5b9f\u7e3e",WBS:"WBS\u756a\u53f7",TASK_ID:"\u30bf\u30b9\u30afID",TASK_NAME:"\u30bf\u30b9\u30af\u540d",ASSIGNEE:"\u62c5\u5f53",ORIG_EST:"\u5f53\u521d\u898b\u7a4d",CURR_EST:"\u73fe\u5728\u898b\u7a4d",ELAPSED:"\u5b9f\u7e3e\u5de5\u6570",REMAIN:"\u6b8b\u5de5\u6570",START_DATE:"\u958b\u59cb\u65e5",FINISH_DATE:"\u5b8c\u4e86\u65e5",LINK:"\u30ea\u30f3\u30af",LINK_TYPE:"\u7a2e\u5225",LINKED_TASK:"\u30bf\u30b9\u30af",INSERT_ROW:"\u884c\u633f\u5165",DELETE_ROW:"\u884c\u524a\u9664",MOVE_UP:"\u4e0a\u3078\u79fb\u52d5",MOVE_DOWN:"\u4e0b\u3078\u79fb\u52d5",INDENT_UP:"\u4e00\u6bb5\u4e0a\u3052\u308b \u2190",INDENT_DOWN:"\u4e00\u6bb5\u4e0b\u3052\u308b \u2192"}),t.getInstance().messages};x.createPrTable=function(p){var S=x.util,c=x.i18n,e=x.createTable,t=x.createTableModel,l=x.defaultCellRendererFactory;p=S.extend({maxIndent:8,dayInHours:7.75,isHoliday:function(e){return 0==e.getDay()||6==e.getDay()},getActHours:function(e,t){return this.isHoliday(e)?0:p.dayInHours}},p||{});var a,i,o,n,r,s,d,u=[{colSpan:7,cellInDays:1,dateCellWidth:40},{colSpan:4,cellInDays:7,dateCellWidth:25}],f=E(),h={thead:[[{label:"",colSpan:4},{label:f.MAN_HOURS,colSpan:4},{label:f.ORIGINAL,colSpan:2},{label:f.ACTUAL,colSpan:2},{label:f.LINK,colSpan:2}],[{label:f.WBS,dataField:"wbsId",width:50},{label:f.TASK_ID,dataField:"taskId",width:50},{label:f.TASK_NAME,dataField:"taskName",editable:!0},{label:f.ASSIGNEE,dataField:"assignee",dataType:"select-one",editable:!0,filterEnabled:!0,width:50,options:function(){return v.model.getUserOptions().list},allowAnonymousOption:!0},{label:f.ORIG_EST,dataField:"origEst",width:60,dataType:"number",decimalDigits:2,editable:!0},{label:f.CURR_EST,dataField:"currEst",width:60,dataType:"number",decimalDigits:2,editable:!0},{label:f.ELAPSED,dataField:"elapsed",width:60,dataType:"number",decimalDigits:2},{label:f.REMAIN,dataField:"remain",width:60,dataType:"number",decimalDigits:2},{label:f.START_DATE,dataField:"startDate",dataType:"date",editable:!0},{label:f.FINISH_DATE,dataField:"finishDate",dataType:"date",editable:!0},{label:f.START_DATE,dataField:"actStartDate",dataType:"date",editable:!1},{label:f.FINISH_DATE,dataField:"actFinishDate",dataType:"date",editable:!1},{label:f.LINK_TYPE,dataField:"linkType",width:40,dataType:"select-one",editable:!0,options:function(){return["","FS","FF","SS","SF"].map(function(e){return{value:e,label:e}})}},{label:f.LINKED_TASK,dataField:"linkedTaskId",dataType:"select-one",editable:!0,options:function(){return v.model.getTaskOptions().list.map(function(e){return{label:e.value?e.value+":"+e.label:e.label,value:e.value}})},labelFunction:function(e){var t=v.model.getTaskOptions().map[e];return"string"==typeof t?e?e+":"+t:t:"?"}}]]},g=(a={},i=0,h.thead.forEach(function(e){var n=0;e.forEach(function(e){e=S.extend({rowSpan:1,colSpan:1,label:""},e);var t=S.getCellId(i,n);a[t]=e,n+=e.colSpan}),i+=1}),o=a,function(e,t){var n=S.getCellId(e,t);return o[n]||{}}),m=(n=function(l){return function(e){for(var t=0,n=!0,a=0;a<e.length;a+=1)n&&0<e[a].task[l].length&&(n=!1),t+=+(e[a].task[l]||"0");return n?"":""+t}},s=function(l,i){return function(e){for(var t="",n=0;n<e.length;n+=1){var a=e[n][l][i];a&&(t=t?S.max(t,a):a)}return t}},{startDate:(r=function(l,i){return function(e){for(var t="",n=0;n<e.length;n+=1){var a=e[n][l][i];a&&(t=t?S.min(t,a):a)}return t}})("task","startDate"),finishDate:s("task","finishDate"),actStartDate:r("task","actStartDate"),actFinishDate:s("task","actFinishDate"),simStartDate:r("taskEx","simStartDate"),simFinishDate:s("taskEx","simFinishDate"),origEst:n("origEst"),currEst:n("currEst"),elapsed:n("elapsed"),remain:n("remain"),assignee:function(e){for(var t={},n=[],a=0;a<e.length;a+=1){var l=e[a].task.assignee;l&&(t[l]||(t[l]=!0,n.push(l)))}return n}}),v=e(S.extend(t(),{tasks:null,selectedRows:[],dateTableState:null,taskExByRow:null,viewRows:null,rowByTaskId:null,dateInfo:null,userOptions:null,taskOptions:null,invalidateTasks:function(){this.taskExByRow=null,this.viewRows=null,this.rowByTaskId=null,this.dateInfo=null,this.userOptions=null,this.taskOptions=null},getUserOptions:function(){if(null==this.userOptions){var t={},n=[{label:"",value:""}];this.tasks.forEach(function(e){e.assignee&&!t[e.assignee]&&(t[e.assignee]=!0,n.push({label:e.assignee,value:e.assignee}))}),n.sort(function(e,t){return e.value<t.value?-1:1}),this.userOptions={map:t,list:n}}return this.userOptions},getTaskOptions:function(){if(null==this.taskOptions){var t={},e=[{taskId:0,taskName:""}].concat(this.tasks).map(function(e){return t[e.taskId]=e.taskName,{value:e.taskId,label:e.taskName}});this.taskOptions={map:t,list:e}}return this.taskOptions},getDateInfo:function(){return this.dateInfo||(this.dateInfo=this.createDateInfo()),this.dateInfo},createDateInfo:function(){for(var e=this.getViewRows(),t="",n="",a=0;a<e.length;a+=1){var l=this.getTaskExAt(a);l.simStartDate&&(t?(t=S.min(t,l.simStartDate),n=S.max(n,l.simStartDate)):t=n=l.simStartDate),l.simFinishDate&&(t?(t=S.min(t,l.simFinishDate),n=S.max(n,l.simFinishDate)):t=n=l.simFinishDate)}var i=new Date,o=new Date;t&&(i=S.strToDate(t),o=S.strToDate(n)),i=new Date(i.getFullYear(),i.getMonth(),i.getDate()-(i.getDay()+6)%7);var r=this.getDateSpec();return{numColumns:Math.floor((o.getTime()-i.getTime())/T/(r.colSpan*r.cellInDays)+1)*r.colSpan,getDate:function(e){return new Date(i.getFullYear(),i.getMonth(),i.getDate()+e)}}},acceptTask:function(e){return!0},getViewRows:function(){if(null==this.viewRows){!function(e){for(var t=x.util,n=e.getTaskCount(),a=[],l=0;l<n;l+=1){var i=e.getTaskAt(l);for(i.grouped=l+1<n&&e.getTaskAt(l+1).indent>i.indent;a.length<=i.indent;)a.push(0);if(a.length>i.indent+1&&(a=a.slice(0,i.indent+1)),a[i.indent]+=1,i.wbsId=a.join("."),!i.grouped){var o=0,r="",s="";for(var d in i.act)r?(r=t.min(r,d),s=t.max(s,d)):r=s=d,o+=+i.act[d];var u=i.currEst||i.origEst,c=+u-o;i.elapsed=0!=o?t.formatNumber(o,2):"",i.remain=""==u?"":t.formatNumber(c,2),i.actStartDate=r,i.actFinishDate=s,0!=+i.remain&&(i.actFinishDate="")}}}(this);for(var t=[],e=this.getTaskCount(),n=0;n<e;n+=1){var a=this.getTaskAt(n);(a.grouped||this.acceptTask(a))&&t.push(n)}var l=D(p,m,{getTaskCount:function(){return t.length},getTaskAt:function(e){return this.getTaskAt(t[e])}.bind(this)});this.viewRows=t.filter(function(e,t){var n=this.getTaskAt(e);return this.acceptTask(n.grouped?l[t]:n)}.bind(this))}return this.viewRows},getTaskExAt:function(e){if(!this.taskExByRow){var t=this.getViewRows();this.taskExByRow=D(p,m,{getTaskCount:function(){return t.length},getTaskAt:function(e){return this.getTaskAt(t[e])}.bind(this)})}return this.taskExByRow[e]},getRowByTaskId:function(e){if(!this.rowByTaskId){for(var t={},n=this.getTaskCount(),a=0;a<n;a+=1)t[this.getTaskAt(a).taskId]=a;this.rowByTaskId=t}return this.rowByTaskId[e]},getTaskCount:function(){return this.tasks.length},getTaskAt:function(e){return this.tasks[e]},getSelectedRows:function(){return this.selectedRows},setSelectedRows:function(e){this.selectedRows=e},getNumColumns:function(){return[1,h.thead[1].length,this.getDateInfo().numColumns]},getNumRows:function(){return[h.thead.length,this.getViewRows().length,1]},getContentWidth:function(){return this.userSettings.contentWidth},setContentWidth:function(e){this.userSettings.contentWidth=e},setCellWidthAt:function(e,t){this.userSettings.cellWidths[e]=Math.max(10,Math.min(t,300))},getCellWidthAt:function(e){var t=this.getNumColumns();return e<t[0]?20:e<t[0]+t[1]?this.userSettings.cellWidths[e]?this.userSettings.cellWidths[e]:g(1,e-t[0]).width||80:this.getDateSpec().dateCellWidth},getCellHeightAt:function(e){return 20},getCellAt:function(e,t,n){var a,l,i=this.getNumColumns(),o=this.getNumRows(),r=this.getDateSpec(),s=this.getDateInfo(),d={value:"",colSpan:1,rowSpan:1,className:""};if(e<o[0])if(d.className+=" ${prefix}-header",t<i[0]);else if(t<i[0]+i[1])S.extend(d,g(e,t-i[0])),d.factory=w,d.value=d.label||"",delete d.editable,delete d.dataType,delete d.labelFunction;else{l=t-(i[0]+i[1]);var u=s.getDate(l*r.cellInDays);p.isHoliday(u)&&(d.className+=" ${prefix}-holiday"),0==e?l%r.colSpan==0&&(d.value=u.getFullYear()+"/"+(u.getMonth()+1)+"/"+u.getDate(),d.colSpan=r.colSpan):(d.className+=" ${prefix}-date",d.value=""+u.getDate())}else if(e<o[0]+o[1])if(a=e-o[0],"span"==n||-1!=this.selectedRows.indexOf(a)&&(d.className+=" ${prefix}-selected"),t<i[0]);else if(t<i[0]+i[1])if("span"==n);else{var c=this.getTaskAt(this.getViewRows()[a]),f=this.getTaskExAt(a);if(S.extend(d,g(1,t-i[0])),"number"==d.dataType&&(d.className+=" ${prefix}-number"),"taskName"==d.dataField&&(d.className+=" ${prefix}-indent"+c.indent),"wbsId"!=d.dataField&&"taskId"!=d.dataField&&"elapsed"!=d.dataField&&"remain"!=d.dataField&&"actStartDate"!=d.dataField&&"actFinishDate"!=d.dataField||(d.className+=" ${prefix}-readonly"),d.value=c[d.dataField],c.grouped&&m[d.dataField]&&(d.value="assignee"==d.dataField?f.assignees.join(","):f[d.dataField],d.editable=!1,d.className+=" ${prefix}-grouped"),!c.grouped&&"remain"==d.dataField){var h=+d.value;0==h?d.className+=" ${prefix}-good":h<0&&(d.className+=" ${prefix}-bad")}}else"span"==n||(d.factory=y,l=t-(i[0]+i[1]),u=s.getDate(l*r.cellInDays),p.isHoliday(u)&&(d.className+=" ${prefix}-holiday"),c=this.getTaskAt(this.getViewRows()[a]),f=this.getTaskExAt(a),d.dataType="number",d.decimalDigits=2,d.className+=" ${prefix}-number",c.grouped?(d.className+=" ${prefix}-grouped",d.value=(f.act||{})[S.parseDate(u)]||""):1==r.cellInDays?(d.editable=!0,d.value=(c.act||{})[S.parseDate(u)]||""):(d.editable=!1,d.value=""),d.value&&(d.className+=" ${prefix}-act-label"),t==Math.max(this.dateTableState.minCol,i[0]+i[1])&&(d.graphParams={baseDate:u,dayInPixel:r.dateCellWidth/r.cellInDays,task:c,taskEx:f}));else d.className+=" ${prefix}-footer";return d},dateSpecsIndex:0,setDateSpecIndex:function(e){this.dateSpecsIndex=e,this.invalidateTasks(),v.invalidate()},getDateSpec:function(){return u[this.dateSpecsIndex]},getTrimedTasks:function(){var e=Object.keys(b());return this.tasks.map(function(t){var n={};return e.forEach(function(e){n[e]=t[e]}),n})},valuechangeHandler:function(e,t){var n,a,l=this.getNumColumns(),i=this.getNumRows(),o=t.row,r=t.col,s=this.getDateInfo();if(o<i[0]);else if(o<i[0]+i[1])if(n=o-i[0],r<l[0]);else if(r<l[0]+l[1]){a=r-l[0];var d=g(1,a).dataField;this.getTaskAt(this.getViewRows()[n])[d]=t.newValue,this.invalidateTasks(),v.render()}else{a=r-(l[0]+l[1]);var u=s.getDate(a),c=this.getTaskAt(this.getViewRows()[n]);t.newValue?c.act[S.parseDate(u)]=t.newValue:delete c.act[S.parseDate(u)],this.invalidateTasks(),v.render()}}}));(d=v.tables).forEach(function(l){if(1==l.tblRow){var e=function(n){var e=S.closest(n.target,{tagName:"TD"});if(e){S.indexOf(e);var t=S.indexOf(e.parentNode),a=l.tbody.children[t].row;d.forEach(function(e){e.tbody.children.forEach(function(e){var t="mouseover"==n.type&&a==e.row?" ${prefix}-selected":"";e.className!=t&&(e.className=t,S.set(e.$el,{attrs:{class:e.className}}))})})}};S.$(l.$el).on("mouseover",e).on("mouseout",e)}}),v.model.on("valuechange",v.model.valuechangeHandler);var b=function(){return{indent:0,wbsId:"",taskId:0,taskName:"",assignee:"",origEst:"",currEst:"",elapsed:"",remain:"",startDate:"",finishDate:"",actStartDate:"",actFinishDate:"",linkType:"",linkedTaskId:0,act:{}}};S.$(v.$el).on("contextmenu",function(e){e.preventDefault()}),v.on("mousedown",function(e,t){if(3==t.originalEvent.which){var n=function(e){S.closest(e.target,{$el:o})||(a(),S.$(document).off("mouseup",n))};S.$(document).on("mouseup",n);var a=function(){o&&(document.body.removeChild(o),o=null)},l=c.getInstance().messages,i=window.getComputedStyle(t.originalEvent.target,null),o=S.createElement("div",{attrs:{class:"${prefix}-contextmenu"},style:{position:"absolute",left:t.originalEvent.pageX+"px",top:t.originalEvent.pageY+"px",fontFamily:i.fontFamily,fontSize:i.fontSize},on:{contextmenu:function(e){e.preventDefault()}}},[l.INSERT_ROW,l.DELETE_ROW,l.MOVE_UP,l.MOVE_DOWN,l.INDENT_UP,l.INDENT_DOWN].map(function(e){return S.createElement("div",{attrs:{class:"${prefix}-menuitem"},props:{textContent:e},on:{click:function(){a(),function(l){var e=function(e,t){var n=this[o[e]];this[o[e]]=this[o[t]],this[o[t]]=n},i=c.getInstance().messages,o=v.model.getViewRows(),t=v.model.getSelectedRows().slice();if(t.sort(),l==i.INSERT_ROW){if(1==t.length){var n=o[t[0]],a=[],r=0;v.model.tasks.forEach(function(e,t){a.push(e),r=Math.max(r,e.taskId),t==n&&a.push(b())}),r+=1;var s=n+1;a[s].indent=a[n].indent,a[s].taskId=r,a[s].taskName="Task#"+r,v.model.tasks=a,v.model.invalidateTasks(),v.invalidate()}}else if(l==i.DELETE_ROW){var d={};t.forEach(function(e){d[o[e]]=!0}),a=[],v.model.tasks.forEach(function(e,t){d[t]||a.push(e)}),v.model.setSelectedRows([]),v.model.tasks=a,v.model.invalidateTasks(),v.invalidate()}else if(l==i.MOVE_UP){a=v.model.tasks.slice(),d=[-1].concat(t);for(var u=1;u<d.length;u+=1)d[u]-1>d[u-1]&&(e.call(a,d[u],d[u]-1),d[u]-=1);v.model.setSelectedRows(d.slice(1)),v.model.tasks=a,v.model.invalidateTasks(),v.invalidate()}else if(l==i.MOVE_DOWN){for(a=v.model.tasks.slice(),d=t.concat([a.length]).reverse(),u=1;u<d.length;u+=1)d[u]+1<d[u-1]&&(e.call(a,d[u],d[u]+1),d[u]+=1);v.model.setSelectedRows(d.slice(1)),v.model.tasks=a,v.model.invalidateTasks(),v.invalidate()}else l!=i.INDENT_UP&&l!=i.INDENT_DOWN||(t.forEach(function(e){var t=v.model.getTaskAt(o[e]),n=t.indent,a=0<e?v.model.getTaskAt(e-1).indent+1:0;a=Math.min(a,p.maxIndent),n+=l==i.INDENT_UP?-1:1,n=Math.max(0,Math.min(n,a)),t.indent=n}),v.model.invalidateTasks(),v.invalidate())}(e)}}})}));document.body.appendChild(o)}});var C=function(e,t,n,a){var l=0;if(n.grouped){if(a.simFinishDate){var i=S.strToDate(a.simStartDate).getTime();l=((S.strToDate(a.simFinishDate).getTime()-i)/T+1)*p.dayInHours}}else l=a.simEst;if(!l)return null;var o=0;n.grouped||(o=(p.dayInHours-(a.simStartHours||0))/p.dayInHours*t);var r,s=S.strToDate(a.simStartDate),d=Math.floor((s.getTime()-e.getTime())/T*t+o),u=Math.floor(l/p.dayInHours*t)-1,c=0;return n.grouped?0!=(r=+(a.currEst||a.origEst||"0"))&&(c=Math.floor(u*+a.elapsed/r)):0!=(r=+(n.currEst||n.origEst||"0"))&&(c=Math.floor(u*+n.elapsed/r)),{left:d,estWidth:u,actWidth:c,assignee:n.grouped?a.assignees.join(","):n.assignee}},N=function(){var n="";return{moveTo:function(e,t){return n+="M"+e+" "+t,this},lineTo:function(e,t){return n+="L"+e+" "+t,this},close:function(){return n+="Z",this},build:function(){return n}}},w=function(t){var n=l(t),a=(t.tableModel,null);return{render:function(e){null==a&&e.filterEnabled&&(a=S.createSVGElement("svg",{attrs:{class:"${prefix}-filter-button",width:15,height:15},style:{position:"absolute",right:"2px",top:"2px"}},[S.createSVGElement("rect",{attrs:{width:15,height:15,rx:2,ry:2}}),S.createSVGElement("path",{attrs:{d:"M2 4L7.5 12L13 4Z"}})]),t.$el.appendChild(a)),n.render(e)},beginEdit:function(e){return n.beginEdit(e)},dispose:function(){n.dispose()}}},y=function(y){var t=function(e){var t,n,a,l,i,o,r,s,d=e.graphParams;null==D&&(t=y,n=S.createSVGElement("rect",{attrs:{class:"${prefix}-est-bar"}}),a=S.createSVGElement("rect",{attrs:{class:"${prefix}-act-bar"}}),l=S.createSVGElement("text",{attrs:{class:"${prefix}-graph-label"}}),i=S.createSVGElement("path",{attrs:{class:"${prefix}-graph-path-s"}}),o=S.createSVGElement("path",{attrs:{class:"${prefix}-graph-path-f"}}),r={},s=window.getComputedStyle(t.$el),D={$el:S.createSVGElement("g",{style:{fontFamily:s.fontFamily,fontSize:s.fontSize}},[n,a,l,i,o]),_setStyle:function(e,t){return r[e]!==t&&(this.$el.style[e]=r[e]=t),this},setVisible:function(e){this._setStyle("display",e?"":"none")},className:"",estInfo:{},setInfo:function(e){(this.estInfo.left!=e.left||this.estInfo.estWidth!=e.estWidth||this.estInfo.actWidth!=e.actWidth||this.estInfo.assignee!=e.assignee||this.estInfo.pathS!=e.pathS||this.estInfo.pathF!=e.pathF)&&(S.set(i,{attrs:{d:e.pathS}}),S.set(o,{attrs:{d:e.pathF}}),S.set(n,{attrs:{x:e.left,y:4,width:Math.max(0,e.estWidth),height:11}}),S.set(a,{attrs:{x:e.left,y:7,width:Math.max(0,e.actWidth),height:5}}),S.set(l,{attrs:{x:e.left+e.estWidth+2,y:14}}),this.estInfo.assignee!=e.assignee&&(l.textContent=e.assignee),this.estInfo=e)}},T.appendChild(D.$el));var u=d.task,c=d.taskEx,f=C(d.baseDate,d.dayInPixel,u,c);if(f){var h="${prefix}-graph";if(h+=" ${prefix}-indent"+u.indent,u.grouped&&(h+=" ${prefix}-grouped"),D.className!=h&&(D.className=h,S.set(D.$el,{attrs:{class:D.className}})),f.path="",u.linkedTaskId&&u.linkType){var p=E.getRowByTaskId(u.linkedTaskId);if("number"==typeof p){var g=E.getViewRows()[p],m=E.getTaskAt(g),v=E.getTaskExAt(p),b=C(d.baseDate,d.dayInPixel,m,v);if(b){var w=function(e,t,n,a,l){for(var i=e.tableModel,o=i.getNumRows(),r=t+o[0],s=7,d=0,u=Math.min(e.row,r),c=Math.max(e.row,r),f=u;f<c;f+=1)d+=i.getCellHeightAt(f+o[0]);r<e.row&&(d=-d,s=-s-1);var h=a.left+a.estWidth,p=l.left+l.estWidth,g=N();if("SS"==n||"FS"==n?g.moveTo(a.left-4,10):g.moveTo(h+4,10),"SS"==n){var m=Math.min(a.left,l.left);g.lineTo(m-8,10),g.lineTo(m-8,10+d)}else if("FF"==n){var v=Math.max(h,p);g.lineTo(v+8,10),g.lineTo(v+8,10+d)}else"FS"==n?(g.lineTo(a.left-8,10),p<=a.left-8?g.lineTo(a.left-8,10+d):(g.lineTo(a.left-8,10+s),g.lineTo(p+8,10+s),g.lineTo(p+8,10+d))):"SF"==n&&(g.lineTo(h+8,10),h+8<=l.left?g.lineTo(h+8,10+d):(g.lineTo(h+8,10+s),g.lineTo(l.left-8,10+s),g.lineTo(l.left-8,10+d)));"SF"==n||"SS"==n?g.lineTo(l.left,10+d):g.lineTo(p,10+d);var b=N();return"SS"==n||"FS"==n?(b.moveTo(a.left-4,7),b.lineTo(a.left,10),b.lineTo(a.left-4,13)):(b.moveTo(h+4,7),b.lineTo(h,10),b.lineTo(h+4,13)),b.close(),{pathS:g.build(),pathF:b.build()}}(y,p,u.linkType,f,b);f.pathS=w.pathS,f.pathF=w.pathF}}}D.setInfo(f),x()}D.setVisible(!!f)},x=function(){for(var e=E.dateTableState,t=e.tableLeft,n=e.tableTop,a=e.minCol;a<y.col;a+=1)t+=E.getCellWidthAt(a);for(var l=e.minRow;l<y.row;l+=1)n+=E.getCellHeightAt(l);S.set(D.$el,{attrs:{transform:"translate("+t+" "+n+")"}})},T=y.$el.parentNode.parentNode.parentNode.parentNode.firstChild,D=null,E=y.tableModel,n=l(y);return{render:function(e){n.render(e),e.graphParams?t(e):D&&D.setVisible(!1)},beginEdit:function(e){return n.beginEdit(e)},dispose:function(){n.dispose(),D&&(T.removeChild(D.$el),D=null)}}};return v.model.on("contentwidthchange",function(e,t){this.setContentWidth(this.getContentWidth()+t.deltaX),v.invalidate()}).on("cellwidthchange",function(e,t){this.setCellWidthAt(t.col,this.getCellWidthAt(t.col)+t.deltaX),v.invalidate()}),v.on("beforerender",function(e,t){var n=null;t.tables.forEach(function(e){1==e.tblRow&&2==e.tblCol&&(n=e.tableState)}),this.model.dateTableState=n}),v.on("click",function(e,t){if(1==t.originalEvent.which){var n=this.model.getNumColumns(),a=this.model.getNumRows(),l=t.row;if(t.col<n[0])if(l<a[0]);else if(l<a[0]+a[1]){t.originalEvent.preventDefault();var i=l-a[0];if(t.originalEvent.ctrlKey)-1!=this.model.getSelectedRows().indexOf(i)?this.model.setSelectedRows(this.model.getSelectedRows().filter(function(e){return e!=i})):this.model.setSelectedRows(this.model.getSelectedRows().concat([i]));else if(t.originalEvent.shiftKey){var o=this.model.getSelectedRows();if(0<o.length){var r=o[o.length-1],s=Math.min(r,i),d=Math.max(r,i);o=[];for(var u=s;u<=d;u+=1)o.push(u);this.model.setSelectedRows(o)}else this.model.setSelectedRows([i])}else this.model.setSelectedRows([i]);this.invalidate()}}}).on("hidegrid",function(e,t){var n=t;v.tables.forEach(function(e){1==e.tblRow&&2==e.tblCol&&e.setTableVisible(!n)})}),v}}(window.prLib||(window.prLib={})),function(e){var t,S=function(){var a=function(e){for(var t=[],n={},a=1;a<e.length;a+=1){var l=e[a];"object"==typeof l&&("function"==typeof l.splice?t=l:n=l)}return{children:t,opts:n}},t=/\$\{prefix\}/g,i=function(e){return e.replace(t,"pr")},o="\uff10\uff11\uff12\uff13\uff14\uff15\uff16\uff17\uff18\uff19\uff0b\uff0d\uff0e\uff0c\uff0f",r="0123456789+-.,/";if(o.length!=r.length)throw o+","+r;var n=function(e){this.elm=e};return n.prototype={on:function(e,t){return this.elm.addEventListener(e,t),this},off:function(e,t){return this.elm.removeEventListener(e,t),this},addClass:function(t,e){t=i(t);var n="";return(this.elm.getAttribute("class")||"").split(/\s+/g).forEach(function(e){e==t||(n+=" "+e)}),e||(n+=" "+t),elm.setAttribute("class",n),this},removeClass:function(e){return this.addClass(e,!0)}},{extend:function(){for(var e=arguments[0],t=1;t<arguments.length;t+=1){var n=arguments[t];for(var a in n)e[a]=n[a]}return e},callLater:function(e){window.setTimeout(e,0)},set:function(e,t){if(t.attrs)for(var n in t.attrs){var a=t.attrs[n],l=typeof a;if("number"==l||"boolean"==l?a=""+a:"undefined"==l&&(a=""),"string"!=typeof a)throw"bad attr type for "+n+":"+typeof a;"class"==n&&(a=i(a)),e.setAttribute(n,a)}if(t.props)for(var n in t.props)e[n]=t.props[n];if(t.style)for(var n in t.style)e.style[n]=t.style[n]||"";if(t.on)for(var n in t.on)e.addEventListener(n,t.on[n]);return e},createElement:function(e){var t=a(arguments),n=document.createElement(e);return t.children.forEach(function(e){n.appendChild(e)}),this.set(n,t.opts)},createSVGElement:function(e){var t=a(arguments),n=document.createElementNS("http://www.w3.org/2000/svg",e);return t.children.forEach(function(e){n.appendChild(e)}),this.set(n,t.opts)},$:function(e){return new n(e)},closest:function(e,t){for("string"==typeof t.className&&(t.className=i(t.className));null!=e&&1==e.nodeType&&e!=t.root;){if("string"==typeof t.tagName&&e.tagName==t.tagName)return e;if("object"==typeof t.$el&&e==t.$el)return e;if("string"==typeof t.className&&-1!=(e.getAttribute("class")||"").split(/\s+/g).indexOf(t.className))return e;e=e.parentNode}return null},indexOf:function(e){return null==e?-1:Array.prototype.indexOf.call(e.parentNode.childNodes,e)},offset:function(e){var t,n={left:0,top:0},a=null;for(t=e;null!=t.parentNode;t=t.parentNode)if(null!=t.offsetParent){a=t;break}if(null!=a)for(t=a;null!=t.offsetParent;t=t.offsetParent)n.left+=t.offsetLeft,n.top+=t.offsetTop;for(t=e;null!=t.parentNode&&t!=document.body;t=t.parentNode)n.left-=t.scrollLeft,n.top-=t.scrollTop;return n},moveSublist:function(e,t,n,a){var l=e.slice(t,t+n),i=e.slice(0,t).concat(e.slice(t+n));return a=t<a?a-n:a,i.slice(0,a).concat(l).concat(i.slice(a))},getCellId:function(e,t){return e+":"+t},translate:function(e,t,n,a,l,i){var o=(e-t)*(l-a)/(n-t)+a;return Math.max(a,Math.min(Math.round(o),l))},trimRe:/^[\s\u3000]+|[\s\u3000]+$/g,trim:function(e){return e.replace(this.trimRe,"")},rtrimRe:/[\s\u3000]+$/g,rtrim:function(e){return e.replace(this.rtrimRe,"")},format:function(e){for(var t=1;t<arguments.length;t+=1)e=e.replace(new RegExp("\\{"+(t-1)+"\\}"),""+arguments[t]);return e},numRe:/^([\+\-]?)([0-9]*)(\.[0-9]*)?$/,formatNumber:function(e,t,n,a){if(t=t||0,n="string"==typeof n?n:",",a="string"==typeof a?a:".","number"==typeof e&&(e=""+e),"string"!=typeof e)return"";var l=e.match(this.numRe);if(l){if(0==l[2].length&&(!l[3]||1==l[3].length))return"";for(var i=0<l[2].length?l[2]:"0";1<i.length&&"0"==i.charAt(0);)i=i.substring(1);for(var o="-"==l[1],r="";3<i.length;)r=n+i.substring(i.length-3)+r,i=i.substring(0,i.length-3);if(r=i+r,0<t){var s=l[3]||a;r+=a;for(var d=0;d<t;d+=1)r+=d+1<s.length?s[d+1]:"0"}return o&&"0"!=r?"-"+r:r}return e},toNarrowNumber:function(e){for(var t="",n=0;n<e.length;n+=1){var a=e.charAt(n),l=o.indexOf(a);t+=-1!=l?r.charAt(l):a}return t},fillLeftZero:function(e,t){for(;e.length<t;)e="0"+e;return e},formatYM:function(e,t){return e+"/"+(t+1)},formatDate:function(e){return"string"==typeof e&&e.match(/^\d{8}$/)?e.substring(0,4)+"/"+e.substring(4,6)+"/"+e.substring(6,8):""},dateRe:/^(\d{4})\D(\d{1,2})\D(\d{1,2})$/,parseDate:function(e){if("number"==typeof e&&(e=""+e),"string"==typeof e){var t=e.match(this.dateRe);if(!t)return e;e=new Date(+t[1],+t[2]-1,+t[3])}return this.fillLeftZero(""+e.getFullYear(),4)+this.fillLeftZero(""+(e.getMonth()+1),2)+this.fillLeftZero(""+e.getDate(),2)},strToDate:function(e){return new Date(+e.substring(0,4),+e.substring(4,6)-1,+e.substring(6,8))},min:function(e,t){return e<t?e:t},max:function(e,t){return t<e?e:t}}}(),E=function(e,t,n){for(var a=0,l=t;l<n;l+=1)a+=e(l);return a},C=function(a){return a.map(function(e,t){for(var n=0;n<t;n+=1)e+=a[n];return e})},N=function(e,t,n,a){if(n.children&&t<n.children.length)return n.children[t];n.children||(n.children=[]);var l={$el:document.createElement(e)};return a&&a(l),n.$el.appendChild(l.$el),n.children.push(l),l},k=function(){var n={},l=function(e){return n[e]||(n[e]=[])};return{trigger:function(t,n){var a=this;return l(t).forEach(function(e){e.call(a,{type:t},n)}),this},on:function(e,t){return l(e).push(t),this},off:function(e,t){return n[e]=l(e).filter(function(e){return t!=e}),this}}},I=function(a){var l=S.createElement("span");a.$el.appendChild(l);var i=null,o=null,n=null,r=function(e,t){return"number"==e.dataType?S.formatNumber(S.toNarrowNumber(t),e.decimalDigits||0):"date"==e.dataType?S.formatDate(t):(e.dataType,e.labelFunction?e.labelFunction(t):t)};return{render:function(e){var t=r(e,e.value);n!==t&&(l.textContent=t||"\xa0",n=t)},beginEdit:function(t){if(console.log("beginEdit",t),null==i){var e=window.getComputedStyle(a.$el,null);i=S.createElement("input",{attrs:{type:"text"},style:{width:"100%",height:"100%",border:"none",outline:"none",backgroundColor:"transparent",fontFamily:e.fontFamily,fontSize:e.fontSize,textAlign:e.textAlign}}),a.$el.appendChild(i)}if(null==o&&("date"==t.dataType?(o=function(e,t){var n,a=function(e){for(var t=[],n=0;n<e;n+=1)t.push(n);return t},l=window.getComputedStyle(t,null),i={fontFamily:l.fontFamily,fontSize:l.fontSize},o=y.getInstance().messages.DAY_NAMES.split(/,/g),r=function(e,t){var n,a={position:"absolute",top:"0px"};return n=e?(a.right="0px","translate(0 0)"):(a.left="0px","rotate(180) translate(-16 -16)"),S.createSVGElement("svg",{attrs:{width:"16",height:"16"},style:a,on:{click:function(e){t()}}},[S.createSVGElement("rect",{attrs:{class:"${prefix}-cal-button",x:"1",y:"1",width:"14",height:"14"}}),S.createSVGElement("path",{attrs:{class:"${prefix}-cal-button-arrow",d:"M4 2L12 8L4 14",transform:n},style:{pointerEvents:"none"}})])},s=S.createElement("div",{style:{position:"relative"}},[S.createElement("div",{style:S.extend({textAlign:"center",paddingLeft:"16px",paddingRight:"16px"},i),props:{textContent:"title"},on:{click:function(){c.displayDate=new Date(c.today.getFullYear(),c.today.getMonth(),1),g()}}}),r(!1,function(){c.displayDate=new Date(c.displayDate.getFullYear(),c.displayDate.getMonth()-1,1),g()}),r(!0,function(){c.displayDate=new Date(c.displayDate.getFullYear(),c.displayDate.getMonth()+1,1),g()})]),d=S.createElement("table",{attrs:{cellSpacing:"0"}},[S.createElement("thead",[S.createElement("tr",a(7).map(function(e){return S.createElement("th",{props:{textContent:o[e]},style:i})}))]),S.createElement("tbody",a(6).map(function(){return S.createElement("tr",a(7).map(function(){return S.createElement("td",{style:i})}))}))]),u=S.createElement("div",{attrs:{class:"${prefix}-calendar"},style:{position:"absolute"},on:{mousedown:function(e){if(1==e.which){e.preventDefault();var t=S.closest(e.target,{tagName:"TD"});if(null!=t){var n=S.indexOf(t),a=S.indexOf(t.parentNode),l=new Date(c.displayDate.getFullYear(),c.displayDate.getMonth(),c.displayDate.getDate()-c.displayDate.getDay()+7*a+n);f(l),h(!1)}}}}},[s,d]),c={today:(n=new Date,new Date(n.getFullYear(),n.getMonth(),n.getDate())),selectedDate:null,displayDate:null,visible:!0};"string"==typeof e.value&&e.value.match(/^\d{8}$/)?c.selectedDate=S.strToDate(e.value):c.selectedDate=null;var f=function(e){c.selectedDate=e,p(c.selectedDate);var t=c.selectedDate?S.parseDate(c.selectedDate):"",n=t?S.formatDate(t):"";w.trigger("valuechange",{value:t,label:n})},h=function(e){c.visible=e,w.$el.style.display=e?"":"none"},p=function(e){e=e||c.today,c.displayDate=new Date(e.getFullYear(),e.getMonth(),1),g()},g=function(){var e=c.displayDate,t=0;s.firstChild.textContent=S.formatYM(e.getFullYear(),e.getMonth());for(var n=d.childNodes[1],a=0;a<6;a+=1)for(var l=0;l<7;l+=1){var i=new Date(e.getFullYear(),e.getMonth(),e.getDate()-e.getDay()+t),o="";i.getFullYear()==e.getFullYear()&&i.getMonth()==e.getMonth()&&(o+=" ${prefix}-current-month"),c.selectedDate&&c.selectedDate.getTime()==i.getTime()&&(o+=" ${prefix}-selected-date"),c.today.getTime()==i.getTime()&&(o+=" ${prefix}-today"),S.set(n.childNodes[a].childNodes[l],{attrs:{class:o},props:{textContent:""+i.getDate()}}),t+=1}},m=function(e){h(!0),c.selectedDate?f(new Date(c.selectedDate.getFullYear(),c.selectedDate.getMonth(),c.selectedDate.getDate()+e)):f(c.today)};p(c.selectedDate);var v=function(e){switch(e.keyCode){case 38:e.preventDefault(),e.stopPropagation(),m(-1);break;case 40:e.preventDefault(),e.stopPropagation(),m(1);break;case 27:e.preventDefault(),e.stopPropagation(),h(!1)}},b=function(e){1==e.which&&h(!c.visible)};S.$(t).on("keydown",v).on("mousedown",b);var w=S.extend(k(),{$el:u,dispose:function(){S.$(t).off("keydown",v).off("mousedown",b)}});return w}(t,i).on("valuechange",function(e,t){i.value=t.label,i.select(),o.selected=t}),document.body.appendChild(o.$el)):"select-one"==t.dataType&&(o=function(e,t){var n=window.getComputedStyle(t,null),i=A("v"),o=S.createElement("div",{style:{position:"absolute",overflow:"hidden"}}),a=S.createElement("div",{attrs:{class:"${prefix}-select"},style:{position:"absolute",width:"100px",height:"100px",fontFamily:n.fontFamily,fontSize:n.fontSize},on:{mousedown:function(e){e.preventDefault();var t=S.closest(e.target,{className:"${prefix}-select-option"});t&&(c(d.items.children[S.indexOf(t)].index),f(!1))},wheel:function(e){e.preventDefault(),i.scrollTop+=e.deltaY}}},[o,i]);S.set(i,{on:{scroll:function(){p()}}}),document.body.appendChild(a);var r=function(e){var t=S.createElement("div");t.textContent="\uff20",e.appendChild(t);try{return t.offsetHeight}finally{e.removeChild(t)}}(o),s=$(a);document.body.removeChild(a);var d={options:null,indexByValue:null,selectedIndex:-1,items:{$el:o},visible:!0,getIndexByValue:function(e){if(!this.indexByValue){var n={};this.options.forEach(function(e,t){n[e.value]=t}),this.indexByValue=n}var t=this.indexByValue[e];return"number"==typeof t?t:-1},lastValue:t.value},l=function(e){d.options=e,d.indexByValue=null,d.selectedIndex=-1},u=function(){return e.options?e.options():[]},c=function(e){0<=e&&e<d.options.length?(d.selectedIndex=e,h(d.selectedIndex),b.trigger("valuechange",d.options[e])):(d.selectedIndex=-1,b.trigger("valuechange",{label:t.value}))},f=function(e){d.visible=e,b.$el.style.display=d.visible?"":"none"},h=function(e){for(var t=Math.ceil(i.scrollTop/r),n=Math.floor((i.scrollTop+100)/r)-1,a=0;e<t&&0<t;)a-=r,t-=1;for(;n<e&&n<d.options.length-1;)a+=r,n+=1;i.scrollTop+=a,p()},p=function(){S.set(o,{style:{left:"0px",top:"0px",width:100-s.width+"px",height:"100px"}}),S.set(i,{style:{left:100-s.width+"px",top:"0px",width:s.width+"px",height:"100px"}}),S.set(i.firstChild,{style:{height:r*d.options.length+"px"}});var e=-i.scrollTop%r,t=Math.floor(i.scrollTop/r),n=0;for(o.scrollTop=-e;e<100;){var a=N("div",n,d.items,function(e){S.set(e.$el,{style:{overflow:"hidden",whiteSpace:"nowrap"}})});a.index=t,a.option=d.options[t]||{label:""};var l="${prefix}-select-option";t==d.selectedIndex&&(l+=" ${prefix}-select-option-selected"),S.set(a.$el,{attrs:{class:l},props:{textContent:a.option.label||"\xa0"},style:{height:r+"px"}}),t+=1,n+=1,e+=r}},g=function(e){switch(e.keyCode){case 38:e.preventDefault(),e.stopPropagation(),f(!0),c(d.selectedIndex-1);break;case 40:e.preventDefault(),e.stopPropagation(),f(!0),c(d.selectedIndex+1);break;case 27:e.preventDefault(),e.stopPropagation(),f(!1)}},m=function(e){switch(e.keyCode){case 37:case 38:case 39:case 40:break;default:if(d.lastValue!=t.value){d.lastValue=t.value;var n=t.value.toUpperCase(),a=[];u().forEach(function(e,t){-1!=e.label.toUpperCase().indexOf(n)&&a.push(e)}),l(a),p()}}},v=function(e){1==e.which&&f(!d.visible)};S.$(t).on("keydown",g).on("keyup",m).on("mousedown",v);var b=S.extend(k(),{$el:a,dispose:function(){S.$(t).off("keydown",g).off("keyup",m).off("mousedown",v)}});return l(u()),d.selectedIndex=d.getIndexByValue(e.value),S.callLater(function(){h(d.selectedIndex)}),b}(t,i).on("valuechange",function(e,t){void 0!==t.value&&(i.value=t.label,i.select()),o.selected=t}),document.body.appendChild(o.$el))),o){var n=S.offset(a.$el);o.$el.style.left=n.left+"px",o.$el.style.top=n.top+a.$el.offsetHeight+"px"}return l.style.display="none",i.style.display="",i.value=function(e,t){if(null==t)return"";if("number"==e.dataType);else{if("date"==e.dataType)return r(e,t);if("select-one"==e.dataType)return r(e,t)}return t}(t,t.value),i.focus(),i.select(),{endEdit:function(){console.log("endEdit",t);var e=function(e,t){if("number"==e.dataType)return 0==(t=S.toNarrowNumber(t)).length?t:t.match(S.numRe)?S.formatNumber(t,e.decimalDigits||0,""):e.value;if("date"==e.dataType)return 0==(t=S.toNarrowNumber(t)).length?t:t.match(S.dateRe)?S.parseDate(t):e.value;if("select-one"!=e.dataType)return t;if(o.selected){if(void 0!==o.selected.value)return o.selected.value;if(e.allowAnonymousOption)return o.selected.label}return e.value}(t,S.rtrim(i.value));return null!=o&&(document.body.removeChild(o.$el),o.dispose(),o=null),l.style.display="",i.style.display="none",{newValue:e,oldValue:t.value}}}},dispose:function(){null!=i&&(a.$el.removeChild(i),i=null)}}},A=function(e){var t={position:"absolute",left:"0px",top:"0px",width:"0px",height:"0px"};return"h"==e?(t.overflowX="scroll",t.overflowY="hidden"):"v"==e?(t.overflowX="hidden",t.overflowY="scroll"):t.overflow="scroll",S.createElement("div",{style:t},[S.createElement("div",{style:{position:"absolute",left:"0px",top:"0px",width:"1px",height:"1px"}})])},$=function(e){var t=A();t.style.width=t.style.height="50px",t.firstChild.style.width=t.firstChild.style.height="100px",e.appendChild(t);try{return{width:t.offsetWidth-t.clientWidth,height:t.offsetHeight-t.clientHeight}}finally{e.removeChild(t)}},a=function(e,t){return S.createElement("div",{attrs:{class:e},style:{position:"absolute",left:"0px",top:"0px",width:"0px",height:"0px"}})},R=function(e,t){var o="rgba(0,0,255,0)",r=S.createElement("div",{attrs:{class:"${prefix}-resize-bar"},style:{position:"absolute",display:"none",left:"-1px",top:"0px",width:"0px",height:"100px"}}),n=S.createElement("div",{style:{position:"absolute",left:"-3px",top:"0px",width:"5px",height:"100%",cursor:"ew-resize",backgroundColor:o},on:{mousedown:function(e){var t=function(e){l=e.pageX-a,r.style.left=l-1+"px"},n=function(e){S.$(document).off("mousemove",t).off("mouseup",n),document.body.removeChild(i),r.style.display="none",s.trigger("move",{deltaX:l})};e.preventDefault();var a=e.pageX,l=0;S.$(document).on("mousemove",t).on("mouseup",n);var i=S.createElement("div",{style:{position:"absolute",cursor:"ew-resize",backgroundColor:o,left:document.documentElement.scrollLeft+"px",top:document.documentElement.scrollTop+"px",width:window.innerWidth+"px",height:window.innerHeight+"px"}});document.body.appendChild(i),r.style.left="-1px",r.style.height=s.barHeight+"px",r.style.display=""}}}),s=S.extend(k(),{$el:S.createElement("div",{style:{position:"absolute",overflow:"visible",left:"0px",top:"0px",width:"0px",height:"0px"}},[r,n]),barHeight:100});return s},i=function(){var e=S.createElement("colgroup"),t=S.createElement("tbody"),D=S.createElement("table",{style:{position:"absolute",tableLayout:"fixed",borderCollapse:"separate"},props:{cellSpacing:"0"}},[e,t]),E=S.createSVGElement("svg",{style:{position:"absolute"}});return{$el:S.createElement("div",{style:{position:"absolute",overflow:"hidden"},on:{scroll:function(e){e.target.scrollLeft=e.target.scrollTop=0}}},[E,D]),model:null,tblRow:0,tblCol:0,left:0,top:0,width:100,height:100,rowFrom:0,rowTo:0,colFrom:0,colTo:0,colgroup:{$el:e},tbody:{$el:t},tableState:{},setTableVisible:function(e){D.style.display=e?"":"none"},setTableBgVisible:function(e){E.style.display=e?"":"none"},prepare:function(){var e,t,n,a,l,i,o,r,s,d,u=this.model,c=this.left,f=this.top,h=this.width,p=this.height;for(e=this.colFrom;e<this.colTo&&(n=u.getCellWidthAt(e),!(0<c+n));e+=1)c+=n;for(t=this.rowFrom;t<this.rowTo&&(a=u.getCellHeightAt(t),!(0<f+a));t+=1)f+=a;for(o=e,s=t,function(){for(var e=Math.max(0,s-u.maxRowSpan),t=Math.max(0,o-u.maxColSpan),n=null,a=s;e<=a;a-=1)for(var l=o;t<=l;l-=1){var i=u.getCellAt(a,l,"span");1==i.rowSpan&&1==i.colSpan||(n={row:a,col:l})}if(n){for(a=s;a>n.row;a-=1)s-=1,f-=u.getCellHeightAt(s);for(l=o;l>n.col;l-=1)o-=1,c-=u.getCellWidthAt(o)}}(),l=c,i=f,e=o;e<this.colTo&&(n=u.getCellWidthAt(e),!(h<=c+n));e+=1)c+=n;for(t=s;t<this.rowTo&&(a=u.getCellHeightAt(t),!(p<=f+a));t+=1)f+=a;r=Math.min(this.colTo-1,e),d=Math.min(this.rowTo-1,t),this.tableState={tableLeft:l,tableTop:i,minCol:o,maxCol:r,minRow:s,maxRow:d}},render:function(){for(var t=this.model,e=this.tableState.minCol,n=this.tableState.maxCol,a=this.tableState.minRow,l=this.tableState.maxRow,i=0,o=0,r=e;r<=n;r+=1){var s=t.getCellWidthAt(r);N("col",o,this.colgroup).$el.style.width=s+"px",o+=1,i+=s}for(;o<this.colgroup.$el.childNodes.length;o+=1)this.colgroup.$el.childNodes[o].style.width="0px";S.set(D,{style:{width:i+"px"}});for(var d,u=(d={},{setSpaned:function(e,t,n){for(var a=0;a<n.rowSpan;a+=1)for(var l=0;l<n.colSpan;l+=1)0==a&&0==l||(d[S.getCellId(e+a,l+t)]=1)},isSpaned:function(e,t){return d[S.getCellId(e,t)]}}),c=0,f=a;f<=l;f+=1){var h=N("tr",c,this.tbody,function(e){e.$el.style.lineWidth="1"});h.$el.style.height=t.getCellHeightAt(f)+"px",h.row=f;var p=0;for(r=e;r<=n;r+=1)if(!u.isSpaned(f,r)){var g=N("td",p,h,function(e){e.renderer=null,e.tableModel=t,e.colSpan=1,e.rowSpan=1,e.className=""}),m=t.getCellAt(f,r);u.setSpaned(f,r,m),g.row=f,g.col=r,g.colSpan!=m.colSpan&&(g.colSpan=m.colSpan,g.$el.colSpan=g.colSpan),g.rowSpan!=m.rowSpan&&(g.rowSpan=m.rowSpan,g.$el.rowSpan=g.rowSpan);var v=m.className||"";g.className!=v&&(g.className=v,S.set(g.$el,{attrs:{class:g.className}}));var b=m.factory||I;g.factory!=b&&(g.factory=b,g.renderer&&g.renderer.dispose(),g.$el.innerHTML="",g.renderer=g.factory(g)),g.renderer.render(m),p+=1}c+=1}for(;c<this.tbody.$el.childNodes.length;c+=1){for(var w=this.tbody.children[c].children,y=0;y<w.length;y+=1)w[y].renderer.render({});this.tbody.$el.childNodes[c].style.height="0px"}S.set(D,{style:{left:this.tableState.tableLeft+"px",top:this.tableState.tableTop+"px"}});var x=Math.max(0,this.width),T=Math.max(0,this.height);S.set(E,{style:{left:"0px",top:"0px"},attrs:{width:""+x,height:""+T}}),S.set(this.$el,{style:{width:x+"px",height:T+"px"}})}}};window.console||(window.console={log:function(){}}),(t=function(e,t){if(e!==t)throw"expected "+JSON.stringify(e)+" but "+JSON.stringify(t)})("1,230.12",S.formatNumber(S.toNarrowNumber("123\uff10\uff0e\uff11\uff12\uff13"),2)),t("123.123",S.formatNumber(S.toNarrowNumber("123\uff0e\uff11\uff12\uff13"),3)),t("1,230.12",S.formatNumber(S.toNarrowNumber("+123\uff10\uff0e\uff11\uff12\uff13"),2)),t("-1,230.12",S.formatNumber(S.toNarrowNumber("-123\uff10\uff0e\uff11\uff12\uff13"),2));var y={getInstance:function(e){return e=e||navigator.language||navigator.userLanguage,S.extend({},y.en,y[e]||y[e.replace(/\-\w+$/,"")]||{})},en:{messages:{DAY_NAMES:"Su,Mo,Tu,We,Th,Fr,Sa"}},ja:{messages:{DAY_NAMES:"\u65e5,\u6708,\u706b,\u6c34,\u6728,\u91d1,\u571f"}}};prLib.util=S,prLib.i18n=y,prLib.createTable=function(n){var f=[];!function(){for(var e=0;e<9;e+=1)f.push(i())}(),f.forEach(function(t,e){t.model=n,t.tblCol=e%3,t.tblRow=~~(e/3),S.$(t.$el).on("wheel",function(e){e.preventDefault(),1==t.tblCol?h.scrollLeft+=e.deltaX:2==t.tblCol&&(p.scrollLeft+=e.deltaX),1==t.tblRow&&(g.scrollTop+=e.deltaY)})});var h=A("h"),p=A("h"),g=A("v");[h,p,g].forEach(function(e){S.set(e,{on:{scroll:function(e){D.render()}}})});var m=a("${prefix}-h-bar"),v=a("${prefix}-h-bar"),b=a("${prefix}-v-bar"),w=a("${prefix}-v-bar"),y=R().on("move",function(e,t){D.model.trigger("contentwidthchange",t)}),x=[],e=function(o){return function(e){var t=S.closest(e.target,{tagName:"TD"});if(t){var n=t.parentNode,a=n.parentNode,l=S.indexOf(t),i=S.indexOf(n);t=null,f.forEach(function(e){e.tbody.$el==a&&(t=e.tbody.children[i].children[l])}),D.trigger(e.type,{originalEvent:e,row:t.row,col:t.col})}o(e,t)}},T=S.createElement("div",{style:{position:"relative",overflow:"hidden"},on:{click:e(function(e,t){}),mousedown:e(function(e,t){null!=t?1==e.which&&(l.cell&&l.cell.row==t.row&&l.cell.col==t.col?l.cell&&(l.editing=!0):l.isEditableAt(t.row,t.col)&&(e.preventDefault(),l.beginEdit(t.row,t.col,!0))):l.endEdit()}),focusout:function(e){l.endEdit()},keydown:function(e){switch(e.keyCode){case 113:e.preventDefault(),l.editing=!0;break;case 27:e.preventDefault();var t=l.cell;l.endEdit(!0),l.beginEdit(t.row,t.col);break;case 13:e.preventDefault(),l.move(e.shiftKey?-1:1,0);break;case 9:e.preventDefault(),l.move(0,e.shiftKey?-1:1);break;case 37:l.editing||(e.preventDefault(),l.move(0,-1));break;case 38:l.editing||(e.preventDefault(),l.move(-1,0));break;case 39:l.editing||(e.preventDefault(),l.move(0,1));break;case 40:l.editing||(e.preventDefault(),l.move(1,0))}}}},f.map(function(e){return e.$el}).concat([h,p,g,m,v,b,w,y.$el])),l={impl:null,cell:null,editing:!1,isValidCell:function(e,t){var n=D.model.getRowCount(),a=D.model.getColumnCount();return 0<=e&&e<n&&0<=t&&t<a},move:function(e,t){for(var n=l.cell.row,a=l.cell.col;n+=e,a+=t,!this.isEditableAt(n,a)&&this.isValidCell(n+e,a+t););this.isEditableAt(n,a)&&this.beginEdit(n,a,!0)},isEditableAt:function(e,t){return this.isValidCell(e,t)&&!0===D.model.getCellAt(e,t).editable},beginEdit:function(t,n,e){this.endEdit();var a=null,l=C([0].concat(D.model.getNumRows())),i=C([0].concat(D.model.getNumColumns()));if(f.forEach(function(e){l[e.tblRow]<=t&&t<l[e.tblRow+1]&&i[e.tblCol]<=n&&n<i[e.tblCol+1]&&(a=e)}),a){(function(e,t,n){for(var a=e.tableState.tableLeft,l=e.tableState.tableTop,i=e.tableState.minCol,o=e.tableState.minRow;t<o;)o-=1,l-=e.model.getCellHeightAt(o);for(;o<t;)l+=e.model.getCellHeightAt(o),o+=1;for(;n<i;)i-=1,a-=e.model.getCellWidthAt(i);for(;i<n;)a+=e.model.getCellWidthAt(i),i+=1;var r=e.model.getCellWidthAt(n),s=e.model.getCellHeightAt(t),d=a<0?a:e.width<a+r?a+r-e.width:0,u=l<0?l:e.height<l+s?l+s-e.height:0,c=0!=d||0!=u;return c&&(1==e.tblCol?h.scrollLeft+=d:2==e.tblCol&&(p.scrollLeft+=d),1==e.tblRow&&(g.scrollTop+=u)),c})(a,t,n)&&D.render();var o=null;a.tbody.children.forEach(function(e){e.children.forEach(function(e){e.row==t&&e.col==n&&null==o&&(o=e)})}),null!=o&&(this.impl=o.renderer.beginEdit(D.model.getCellAt(t,n)),this.cell={row:t,col:n},this.editing=!1)}},endEdit:function(e){if(null!=this.impl){var t=this.impl,n=this.cell;this.impl=null,this.cell=null;var a=t.endEdit();e||a&&a.newValue!==a.oldValue&&D.model.trigger("valuechange",{row:n.row,col:n.col,newValue:a.newValue,oldValue:a.oldValue})}}},D=S.extend(S.extend(k(),{invalidate:function(){S.callLater(function(){this.valid||this.render()}.bind(this))},render:function(){}}),{$el:T,model:n,tables:f,render:function(){var o=$(this.$el),n=this.$el.clientWidth,r=this.$el.clientHeight,e=this.model.getRowCount(),t=this.model.getColumnCount(),a=this.model.getNumRows(),l=this.model.getNumColumns(),s=[E(this.model.getCellWidthAt.bind(this.model),0,l[0]),E(this.model.getCellWidthAt.bind(this.model),l[0],l[0]+l[1]),E(this.model.getCellWidthAt.bind(this.model),l[0]+l[1],t)],d=[E(this.model.getCellHeightAt.bind(this.model),0,a[0]),E(this.model.getCellHeightAt.bind(this.model),a[0],e-a[2]),E(this.model.getCellHeightAt.bind(this.model),e-a[2],e)],i=C([0].concat(a)),u=C([0].concat(l)),c=Math.max(10,Math.min(this.model.getContentWidth(),s[1]));m.style.top=d[0]-1+"px",m.style.width=n+"px",v.style.top=r-(d[2]+o.height)-1+"px",v.style.width=n+"px",b.style.left=s[0]-1+"px",b.style.height=r+"px",w.style.left=s[0]+c-1+"px",w.style.height=r+"px",y.$el.style.left=s[0]+c+"px",y.$el.style.height=d[0]+"px",y.barHeight=r-o.height,f.forEach(function(e,t){e.rowFrom=i[e.tblRow],e.rowTo=i[e.tblRow+1],e.colFrom=u[e.tblCol],e.colTo=u[e.tblCol+1],0==e.tblCol?(e.$el.style.left="0px",e.left=0,e.width=s[0]):1==e.tblCol?(e.$el.style.left=s[0]+"px",e.left=-h.scrollLeft,e.width=c):2==e.tblCol&&(e.$el.style.left=s[0]+c+"px",e.left=-p.scrollLeft,e.width=n-(s[0]+c+o.width)),0==e.tblRow?(e.$el.style.top="0px",e.top=0,e.height=d[0]):1==e.tblRow?(e.$el.style.top=d[0]+"px",e.top=-g.scrollTop,e.height=r-(d[0]+d[2]+o.height)):2==e.tblRow&&(e.$el.style.top=r-(d[2]+o.height)+"px",e.top=0,e.height=d[2]),2==e.tblCol&&1==e.tblRow?(S.set(g,{style:{left:n-o.width+"px",top:d[0]+"px",width:o.width+"px",height:e.height+"px"}}),S.set(g.firstChild,{style:{height:d[1]+"px"}})):2==e.tblRow&&1==e.tblCol?(S.set(h,{style:{left:s[0]+"px",top:r-o.height+"px",width:e.width+"px",height:o.height+"px"}}),S.set(h.firstChild,{style:{width:s[1]+"px"}})):2==e.tblRow&&2==e.tblCol&&(S.set(p,{style:{left:s[0]+c+"px",top:r-o.height+"px",width:e.width+"px",height:o.height+"px"}}),S.set(p.firstChild,{style:{width:s[2]+"px"}})),e.prepare()}.bind(this)),function(n,e){for(var t=e.tableLeft+s[0],a=0,l=e.minCol;l<e.maxCol;l+=1){if(a>=x.length){var i=R().on("move",function(e,t){n.model.trigger("cellwidthchange",{col:this.col,deltaX:t.deltaX})});T.appendChild(i.$el),x.push(i)}t+=this.model.getCellWidthAt(l),(i=x[a]).$el.style.display="",i.$el.style.left=t+"px",i.$el.style.height=d[0]+"px",i.col=l,i.barHeight=r-o.height,a+=1}for(;a<x.length;a+=1)i=x[a],x[a].$el.style.display="none"}.bind(this)(D,f[1].tableState),this.trigger("beforerender",{tables:f.map(function(e,t){return{tblRow:e.tblRow,tblCol:e.tblCol,tableState:e.tableState}})}),f.forEach(function(e,t){e.render()}.bind(this))}});return D},prLib.createTableModel=function(){return S.extend(S.extend(k(),{maxRowSpan:10,maxColSpan:10,getRowCount:function(){return 1e4},getColumnCount:function(){return 1e4},getCellWidthAt:function(e){return 50},getCellHeightAt:function(e){return 20},getCellAt:function(e,t,n){return{value:e+","+t,colSpan:1,rowSpan:1}}}),{getContentWidth:function(){return 345},getNumColumns:function(){return[1,2,1e4]},getNumRows:function(){return[3,5e3,4]},getRowCount:function(){var t=0;return this.getNumRows().forEach(function(e){t+=e}),t},getColumnCount:function(){var t=0;return this.getNumColumns().forEach(function(e){t+=e}),t}})},prLib.defaultCellRendererFactory=I}(window.prLib||(window.prLib={}));